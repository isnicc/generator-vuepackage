'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

function unwrapExports (x) {
	return x && x.__esModule && Object.prototype.hasOwnProperty.call(x, 'default') ? x['default'] : x;
}

function createCommonjsModule(fn, module) {
	return module = { exports: {} }, fn(module, module.exports), module.exports;
}

var lib = createCommonjsModule(function (module, exports) {
/**
 * @hfe/mp-owl - cat wxmp sdk
 * @version v0.0.4
 * @link http://npm.sankuai.com/package/@hfe/mp-owl
 */
function sizeof(e,t){var n=0,r=void 0,o=void 0,i=void 0;if("utf-16"===(t=t?t.toLowerCase():"")||"utf16"===t)for(o=0, i=e.length;o<i;o++)r=e.charCodeAt(o), n+=r<=65535?2:4;else for(o=0, i=e.length;o<i;o++)r=e.charCodeAt(o), n+=r<=127?1:r<=2047?2:r<=65535?3:4;return n}function serialize(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")}function requestQueue(e){if(e&&task.push(e), !(task.length>1&&e)){var t=task[0],n=t.complete;t.complete=function(e){task.shift(), task.length&&requestQueue(), n&&n.call(this,e);}, wx.request(t);}}function rnd(){return 65535*Math.random()}function rndSeed(){return Math.ceil(rnd()).toString(16)}function MSID(){var e=[],t=(new Date).getTime();return e.push(t.toString(16)), e.push(rndSeed()), e.push(rndSeed()), e.push(rndSeed()), e.join("-")}function getReportVersions(e,t){var n=e.wxAppVersion,r=void 0===n?"Unknown":n,o=t.wxVersion,i=void 0===o?"Unknown":o,a=t.wxLibVersion;return serialize({wxVersion:i,wxLibVersion:void 0===a?"Unknown":a,wxAppVersion:r})}function _classCallCheck$1(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck$2(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function getPageUrl(){var e=getCurrentPages()||[];return e.length?e[e.length-1].__route__:""}function getNetWorkType(){return wx.onNetworkStatusChange&&wx.onNetworkStatusChange(function(e){env.network=e.networkType;}), new Promise(function(e,t){wx.getNetworkType({success:function(t){e(t.networkType);},fail:function(){e("unknown");}}), setTimeout(function(){e("unknown");},2e3);})}function getSystemInfo(){return new Promise(function(e,t){wx.getSystemInfo({success:function(t){var n=t.system,r=void 0===n?"":n,o=t.version,i=void 0===o?"Unknown":o,a=t.SDKVersion,s=void 0===a?"Unknown":a,c=r.toLowerCase().match(/ios/)?"iOS":"Android";e({os:c,wxVersion:i,wxLibVersion:s});},fail:function(){e("unknown");}});})}function getEnv(){var e=getPageUrl();return new Promise(function(t,n){Object.keys(env).length?t(Object.assign({pageUrl:e},env)):Promise.all([getNetWorkType(),getSystemInfo()]).then(function(n){var r=_slicedToArray(n,2),o=r[0],i=r[1];env=Object.assign({},i,{network:o}), t(Object.assign({},env,{pageUrl:e}));}).catch(function(){t({});});})}function _classCallCheck$3(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck$4(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck$5(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function page(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Page,n=e.onLoad,r=e.onReady;e.onLoad=function(e){pageSpeed.pageLoad(), n&&n.call(this,e);}, e.imageError=function(e){errorManager.pushError({content:e.detail&&e.detail.errMsg,category:"jsError",sec_category:"image error",level:"error"});}, e.onReady=function(e){pageSpeed.pageReady(), r&&r.call(this,e);}, t(e);}function app(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:App,n=e.onLaunch,r=e.onError,o=e.onHide;e.onLaunch=function(e){pageSpeed.appLaunch(), n.call(this,e);}, e.onError=function(e){errorManager.onError(e), r&&r.call(this,e);}, e.onHide=function(){errorManager.report(), resource.report(), pageSpeed.report(), o&&o.call(this);}, t(e);}function request(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:wx.request,n=e.url,r=e.data,o=e.complete,i=e.reportError,a=Date.now();e.complete=function(e){var t=e.statusCode,s=e.errMsg,c=void 0===s?"request:ok":s,u=sizeof(JSON.stringify(r||""),"utf-8"),l=sizeof(JSON.stringify(e||""),"utf-8"),f=Date.now()-a,p={};if(i&&"request:fail"!==c){var h=i(i)||{},g=h.log,v=void 0===g?"":g,d=h.code,y=void 0===d?200:d,w=h.name,k=void 0===w?"":w,C="";(v||k)&&(C="ajaxError"), p={statusCode:t+"|"+y,logContent:v,firstCategory:C,secondCategory:k};}resource.pushRequest(Object.assign({timestamp:a,requestbyte:u,responsebyte:l,statusCode:t,resourceUrl:n,responsetime:f},p)), o&&o.call(this,e);}, t(e);}Object.defineProperty(exports,"__esModule",{value:!0});var task=[],STOREKEY="CATWXMPSDK",Config=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"https://catfront.dianping.com";if(_classCallCheck$1(this,e), this.env="pro", Object.assign(this,t), !this.unionId){var r=wx.getStorageSync(STOREKEY+"-unionId");r?this.unionId=r:(this.unionId=MSID(), wx.setStorage({key:STOREKEY+"-unionId",data:this.unionId}));}this.reportUrl=n;},_createClass$1=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1, r.configurable=!0, "value"in r&&(r.writable=!0), Object.defineProperty(e,r.key,r);}}return function(t,n,r){return n&&e(t.prototype,n), r&&e(t,r), t}}(),MetricManager=function(){function e(t){_classCallCheck$2(this,e), this.config=t, this.tags={}, this.kvs={};}return _createClass$1(e,[{key:"setTags",value:function(e){this.tags=Object.assign(this.tags,e);}},{key:"getTags",value:function(e){return e?this.tags[e]:this.tags}},{key:"setMetric",value:function(e,t){"string"==typeof e&&"number"==typeof t&&(this.kvs[e]||(this.kvs[e]=[]), this.kvs[e].push(t));}},{key:"getMetric",value:function(e){return e?this.kvs[e]:this.kvs}},{key:"clearMetric",value:function(){this.kvs={};}},{key:"_rollbackMetric",value:function(e){for(var t in e)e.hasOwnProperty(t)&&(this.kvs[t]=e[t].concat(this.kvs[t]||[]));}},{key:"report",value:function(){var e=this;if("dev"!==this.config.env){var t=this.config,n=t.reportUrl,r=t.project;if(this.kvs&&0!==Object.keys(this.kvs).length){var o={kvs:this.kvs,tags:this.tags,ts:parseInt(+new Date/1e3)},i=this.kvs;this.clearMetric(), requestQueue({url:n+"/api/metric?v=1&p="+r,method:"POST",header:{"Content-Type":"application/x-www-form-urlencoded"},data:"data="+encodeURIComponent(JSON.stringify(o)),fail:function(){e._rollbackMetric(i);}});}}}}]), e}(),_slicedToArray=function(){function e(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value), !t||n.length!==t);r=!0);}catch(e){o=!0, i=e;}finally{try{!r&&s.return&&s.return();}finally{if(o)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),env={},_createClass$2=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1, r.configurable=!0, "value"in r&&(r.writable=!0), Object.defineProperty(e,r.key,r);}}return function(t,n,r){return n&&e(t.prototype,n), r&&e(t,r), t}}(),ErrorManager=function(){function e(t){_classCallCheck$3(this,e), this.config=t, this.error=[];}return _createClass$2(e,[{key:"pushError",value:function(e){var t=this,n=this.config,r=n.project,o=n.unionId;getEnv().then(function(n){var i=n.pageUrl,a=n.os,s=n.network,c=Object.assign({pageUrl:i,os:a,network:s,timestamp:Date.now(),project:r,unionId:o},e);t.error.push(c);});}},{key:"onError",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"jsError",n=e.replace("thirdScriptError","").split(";");n=n.length?n[0]:"", n=n.replace(/\t|\n/g,""), this.pushError({content:e,category:t,sec_category:n,level:"error"});}},{key:"report",value:function(){var e=this;if("dev"!==this.config.env){var t=this;t.error.length&&getEnv().then(function(n){requestQueue({url:e.config.reportUrl+"/api/log?v=1&"+getReportVersions(t.config,n),data:"c="+encodeURIComponent(JSON.stringify(e.error)),method:"POST",header:{"content-type":"application/x-www-form-urlencoded;"},success:function(){t.error=[];}});});}}}]), e}(),_createClass$3=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1, r.configurable=!0, "value"in r&&(r.writable=!0), Object.defineProperty(e,r.key,r);}}return function(t,n,r){return n&&e(t.prototype,n), r&&e(t,r), t}}(),Resource=function(){function e(t){_classCallCheck$4(this,e), this.config=t, this.data="";}return _createClass$3(e,[{key:"pushRequest",value:function(e){var t=this,n=e.requestbyte,r=void 0===n?"":n,o=e.responsebyte,i=void 0===o?"":o,a=e.statusCode,s=void 0===a?"":a,c=e.resourceUrl,u=void 0===c?"":c,l=e.responsetime,f=void 0===l?"":l,p=e.firstCategory,h=void 0===p?"":p,g=e.secondCategory,v=void 0===g?"":g,d=e.logContent,y=void 0===d?"":d,w=Date.now(),k=this.config,C=k.project,m=k.unionId;getEnv().then(function(e){var n=e.network,o=e.os,a=e.pageUrl;t.data+="S\t\t\t"+n+"\t\t"+o+"\t"+m+"\n      "+u+"\t"+w+"\t"+r+"\t"+i+"\t"+f+"\t"+C+"\t"+a+"\t"+s+"\t"+h+"\t"+v+"\t"+y+"\n";});}},{key:"report",value:function(){var e=this.config,t=e.env,n=e.reportUrl;if("dev"!==t){var r=this,o=this.data;o&&getEnv().then(function(e){requestQueue({url:n+"/api/batch?v=1&"+getReportVersions(r.config,e),data:{c:o},header:{"content-type":"application/x-www-form-urlencoded;"},method:"POST",success:function(){this.data="";}});});}}}]), e}(),_createClass$4=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1, r.configurable=!0, "value"in r&&(r.writable=!0), Object.defineProperty(e,r.key,r);}}return function(t,n,r){return n&&e(t.prototype,n), r&&e(t,r), t}}(),PageSpeed=function(){function e(t){_classCallCheck$5(this,e), this.config=t, this.speed={};}return _createClass$4(e,[{key:"pushSpeed",value:function(e,t,n){var r=this.speed,o=this.config;r[e]||(r[e]={}, r[e].customspeed=[]), getEnv().then(function(i){var a=i;a.pageurl=e||a.pageUrl, delete a.pageUrl;var s=o.project,c=o.unionId,u=o.wxAppVersion;Object.assign(r[e],a,{project:s,timestamp:Date.now(),unionId:c,speed:"0|0|0",wxAppVersion:u}), r[e].customspeed[t]=n;});}},{key:"start",value:function(e,t){this["start-"+e+"-"+t]=Date.now();}},{key:"end",value:function(e,t){var n=this["start-"+e+"-"+t],r=this["start-app-0"];r&&(delete this["start-app-0"], this.pushSpeed("app",0,Date.now()-r)), n&&this.pushSpeed(e,t,Date.now()-n);}},{key:"appLaunch",value:function(){this.start("app",0);}},{key:"pageLoad",value:function(){this.start(getPageUrl(),0);}},{key:"pageReady",value:function(){this.end(getPageUrl(),0);}},{key:"report",value:function(){if("dev"!==this.config.env){var e=this.speed,t=this.config.reportUrl;Object.keys(e).map(function(n){var r=Object.assign({},e[n]);r.customspeed=r.customspeed.join("|"), requestQueue({url:t+"/api/speed?v=1&"+serialize(r),header:{"content-type":"application/x-www-form-urlencoded;"},method:"GET",success:function(){delete e[n];}});});}}}]), e}(),RATE=.01,versionReport=function(e,t){if(e&&t&&!(Math.random()>RATE)){var n={v:1,rate:RATE,project:e,version:"v_0.0.4",pageurl:encodeURIComponent("app"),count:1},r=t.reportUrl+"/api/version?"+serialize(n);setTimeout(function(){requestQueue({method:"GET",url:r});},1500);}},_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1, r.configurable=!0, "value"in r&&(r.writable=!0), Object.defineProperty(e,r.key,r);}}return function(t,n,r){return n&&e(t.prototype,n), r&&e(t,r), t}}(),errorManager=void 0,resource=void 0,pageSpeed=void 0,Owl=function(){function e(t,n){_classCallCheck(this,e), this.config=new Config(t,n), this.error=errorManager=new ErrorManager(this.config), this.resource=resource=new Resource(this.config), this.pageSpeed=pageSpeed=new PageSpeed(this.config), versionReport("cat-sdk-wxmp",this.config);}return _createClass(e,[{key:"newMetric",value:function(){return new MetricManager(this.config)}},{key:"report",value:function(){this.error.report(), this.resource.report();}}]), e}();exports.Owl=Owl, exports.page=page, exports.app=app, exports.request=request;
});

var index = unwrapExports(lib);
var lib_1 = lib.Owl;
var lib_2 = lib.page;
var lib_3 = lib.app;
var lib_4 = lib.request;

exports['default'] = index;
exports.Owl = lib_1;
exports.page = lib_2;
exports.app = lib_3;
exports.request = lib_4;
